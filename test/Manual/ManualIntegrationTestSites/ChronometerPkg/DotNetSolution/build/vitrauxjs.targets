<Project>
	<Target 
		Name="PrepareVitrauxContent" 
		DependsOnTargets="ResolvePackageAssets" 
		Condition="'$(Configuration)' == 'Release'">
		<ItemGroup>
			<VitrauxPackage Include="@(ContentWithTargetPath)"
								 Condition=" '%(ContentWithTargetPath.NuGetPackageId)' == 'Vitraux' ">
				<Id>%(ContentWithTargetPath.NuGetPackageId)</Id>
				<Version>%(ContentWithTargetPath.NuGetPackageVersion)</Version>
			</VitrauxPackage>
		</ItemGroup>

		<ItemGroup>
			<VitrauxPackagePath Include="$([System.IO.Path]::Combine(
				  '$(NuGetPackageRoot)',
				  '%(VitrauxPackage.Id)',
				  '%(VitrauxPackage.Version)',
				  'contentFiles', 'any', 'any',
				  'vitraux-%(VitrauxPackage.Version)-min.js'
			  ))" />
		</ItemGroup>

		<Message Text="Copying  vitraux-%(VitrauxPackage.Version)-min.js from @(VitrauxPackagePath)" Importance="High" />
	</Target>
	
	<Target 
		Name="CopyVitrauxJs" 
		AfterTargets="Build"  
		DependsOnTargets="PrepareVitrauxContent" 
		Condition="'$(Configuration)' == 'Release'">
		<Copy
			  SourceFiles="@(VitrauxPackagePath)"
			  DestinationFolder="$(ProjectDir)..\TestSite\"
			  SkipUnchangedFiles="true" />
	</Target>
</Project>
