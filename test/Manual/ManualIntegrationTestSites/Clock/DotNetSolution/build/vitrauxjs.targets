<Project>

	<Target Name="PrepareVitrauxContent" DependsOnTargets="ResolvePackageAssets">
		<ItemGroup>
			<VitrauxFromAssets Include="@(ContentWithTargetPath)"
								 Condition=" '%(ContentWithTargetPath.NuGetPackageId)' == 'Vitraux' ">
				<Id>%(ContentWithTargetPath.NuGetPackageId)</Id>
				<Version>%(ContentWithTargetPath.NuGetPackageVersion)</Version>
			</VitrauxFromAssets>
		</ItemGroup>

		<!-- 2) Ahora generamos un item MyPackage (con Identity/Version como querías) -->
		<ItemGroup>
			<VitrauxPackage Include="@(VitrauxFromAssets)">
				<Id>%(VitrauxFromAssets.Id)</Id>
				<Version>%(VitrauxFromAssets.Version)</Version>
			</VitrauxPackage>
		</ItemGroup>

		<!-- 3) Construimos la ruta del archivo usando MyPackage.Identity y MyPackage.Version -->
		<ItemGroup>
			<VitrauxPackagePath Include="$([System.IO.Path]::Combine(
				  '$(NuGetPackageRoot)',
				  '%(VitrauxPackage.Id)',
				  '%(VitrauxPackage.Version)',
				  'contentFiles',
				  'any',
				  'any',
				  'vitraux-%(VitrauxPackage.Version)-min.js'
			  ))" />
		</ItemGroup>

		<!-- Debug -->
		<Message Text="VitrauxPackage: %(VitrauxPackage.Id) v%(VitrauxPackage.Version)" Importance="High" />
		<Message Text="VitrauxPackagePath: @(VitrauxPackagePath)" Importance="High" />

		<Copy
			  SourceFiles="@(VitrauxPackagePath)"
			  DestinationFolder="$(ProjectDir)..\TestSite\"
			  SkipUnchangedFiles="true" />
	</Target>
	<Target Name="CopyVitrauxJs" AfterTargets="Build" DependsOnTargets="PrepareVitrauxContent">
		<Copy
			  SourceFiles="@(VitrauxPackagePath)"
			  DestinationFolder="$(ProjectDir)..\TestSite\"
			  SkipUnchangedFiles="true" />
	</Target>
</Project>
