class t extends Error{constructor(t){super(`Vitraux Internal Error: ${t}`)}}class e{static#t;async getActionDispatcher(){if(!e.#t){const t=(await globalThis.getDotnetRuntime(0)).getAssemblyExports,i=await t("Vitraux.dll");e.#t=i.Vitraux.Execution.Actions.ActionDispatcher}return e.#t}}class i{#e;#i;#n;constructor(t,e,i){this.#e=t,this.#i=e,this.#n=i}async dispatchActionSync(){(await this.#n.getActionDispatcher()).DispatchAction(this.#e,this.#i)}async dispatchActionAsync(){const t=await this.#n.getActionDispatcher();await t.DispatchActionAsync(this.#e,this.#i)}}class n{#e;#i;#o;#n;constructor(t,e,i,n){this.#e=t,this.#i=e,this.#o=i,this.#n=n}async dispatchParametrizableActionSync(t){const e=this.#o.call({},t);(await this.#n.getActionDispatcher()).DispatchParametrizableAction(this.#e,this.#i,e)}async dispatchParametrizableActionAsync(t){const e=this.#o.call({},t),i=await this.#n.getActionDispatcher();await i.DispatchParametrizableActionAsync(this.#e,this.#i,e)}}class o{#s;constructor(t){this.#s=t}async handleEvent(){await this.#s.dispatchActionSync()}}class s{#s;constructor(t){this.#s=t}async handleEvent(){await this.#s.dispatchActionAsync()}}class a{#s;constructor(t){this.#s=t}async handleEvent(t){await this.#s.dispatchParametrizableActionSync(t)}}class c{#s;constructor(t){this.#s=t}async handleEvent(t){await this.#s.dispatchParametrizableActionAsync(t)}}globalThis.vitraux={config:{useShadowDom:!0,configure(t){this.useShadowDom=t}},getFullVMKey:t=>"vitraux-vms-"+t,storedElements:{elements:{},getElementByIdAsArray(t){const e=document.getElementById(t);return e?[e]:[]},getStoredElementByIdAsArray(t,e){return this.elements[e]??this.storeElementByIdAsArray(t,e)},storeElementByIdAsArray(t,e){const i=this.getElementByIdAsArray(t);return this.elements[e]=i,i},getElementsByQuerySelector:(t,e)=>t.querySelectorAll(e),getStoredElementsByQuerySelector(t,e,i){return this.elements[i]??this.storeElementsByQuerySelector(t,e,i)},storeElementsByQuerySelector(t,e,i){const n=this.getElementsByQuerySelector(t,e);return this.elements[i]=n,n},getTemplate(t){return this.trimTemplateContent(document.getElementById(t)?.content)},getStoredTemplate(t,e){return this.elements[e]??this.storeTemplate(t,e)},storeTemplate(t,e){const i=this.getTemplate(t);return this.elements[e]=i,i},async fetchElement(t){const e=await fetch(t),i=await e.text(),n=document.createElement("template");return n.innerHTML=i.trim(),this.trimTemplateContent(n?.content)},async getFetchedElement(t,e){return this.elements[e]??await this.storeFetchedElement(t,e)},async storeFetchedElement(t,e){const i=await this.fetchElement(t);return this.elements[e]=i,i},trimTemplateContent(t){if(!t)return t;for(let e=0;this.tryRemoveEmptyTextNode(t,e);e++);for(let e=t.childNodes.length-1;this.tryRemoveEmptyTextNode(t,e);e--);return t},tryRemoveEmptyTextNode(t,e){const i=t.childNodes[e];return!(!i||i.nodeType!==Node.TEXT_NODE||i.textContent.trim())&&(t.removeChild(i),!0)}},updating:{utils:{isValueValid:t=>t||0===t||!1===t||""===t},vmFunctions:{vms:[],async executeInitializationView(t){const e=new Function(t);await e()},async executeUpdateViewFunctionFromJson(t,e){const i=JSON.parse(e);await this.executeUpdateViewFunction(t,i)},async executeUpdateViewFunction(t,e){const i=this.vms[t];await i(e)},getFunctionsCodeFromVersion(e,i){if(!e||!i)throw new t("vmKey and version must be set in getFunctionsCodeFromVersion!");const n=localStorage.getItem(globalThis.vitraux.getFullVMKey(e));if(!n)return!1;const o=JSON.parse(n);return o.version===i&&o},async tryInitializeViewFunctionsFromCacheByVersion(e,i){if(!i)throw new t("Version must be set in tryInitializeViewFunctionsFromCacheByVersion!");const n=this.getFunctionsCodeFromVersion(e,i);return!!n&&(await this.executeInitializationView(n.initializationCode),this.createUpdateViewFunction(e,n.updateViewCode),!0)},async initializeNewViewFunctionsToCacheByVersion(e,i,n,o){if(!i)throw new t("Version must be set in initializeNewViewFunctionsToCacheByVersion!");await this.executeInitializationView(n),this.createUpdateViewFunction(e,o),this.storeFunctions(e,i,n,o)},async initializeNonCachedViewFunctions(t,e,i){await this.executeInitializationView(e),this.createUpdateViewFunction(t,i)},createUpdateViewFunction(t,e){var i="return (async () => {"+e+"})()";this.vms[t]=new Function("vm",i)},storeFunctions(t,e,i,n){const o={initializationCode:i,updateViewCode:n,version:e};localStorage.setItem(globalThis.vitraux.getFullVMKey(t),JSON.stringify(o))}},dom:{setElementsContent(t,e){for(const i of t)i.textContent=e},setElementsHtml(t,e){for(const i of t)i.innerHTML=e},setElementsAttribute(t,e,i){("boolean"==typeof i?this.toggleBoolAttribute:this.setAttributeValue)(t,e,i)},setAttributeValue(t,e,i){for(const n of t)n.setAttribute(e,i)},toggleBoolAttribute(t,e,i){for(const n of t)n.toggleAttribute(e,i)},updateValueByInsertingElements(t,e,i,n){if(t)for(const o of e){const e=t.cloneNode(!0);n(i(e)),this.appendOnlyChild(o,e)}},async updateTable(t,e,i,n,o){for(const s of t){const t=document.createElement("tbody");for(const e of o)await this.addNewRow(t,i,n,e);s.tBodies[e].replaceWith(t)}},async updateCollectionByPopulatingElements(t,e,i,n){for(const o of t){const t=[];for(const o of n){const n=await this.updateCollectionElement(e,i,o);t.push(n)}this.replaceChildren(o,t)}},async addNewRow(t,e,i,n){const o=await this.updateCollectionElement(e,i,n);t.appendChild(o)},async updateCollectionElement(t,e,i){const n=t.cloneNode(!0);return await e(n,i),n},replaceChildren(t,e){this.tryAttachShadow(t).replaceChildren(...e)},appendOnlyChild(t,e){this.replaceChildren(t,[e])},tryAttachShadow(t){return this.supportShadowDom(t)?this.getAttachedShadow(t):t},getAttachedShadow:t=>t.shadowRoot?t.shadowRoot:t.attachShadow({mode:"open"}),supportShadowDom(t){if(!globalThis.vitraux.config.useShadowDom)return!1;if(!t||t.nodeType!==Node.ELEMENT_NODE)return!1;if(t.shadowRoot)return!0;const e=new Set(["article","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),i=t.tagName.toLowerCase();return e.has(i)||i.includes("-")&&customElements.get(i)}}},actions:{dom:{getElementsContent:t=>t.map(t=>t.textContent),getElementsAttribute:(t,e)=>t.map(t=>function(t,e){const i=t.getAttribute(e);return e===i||i}(t,e)),getInputsValue:t=>[...t].map(t=>t.value)},registration:{vmActions:[],actionRegistrationStrategy:Object.freeze({OnlyOnceAtStart:"OnlyOnceAtStart",OnlyOnceOnDemand:"OnlyOnceOnFirstViewModelRendering",Always:"AlwaysOnViewModelRendering"}),getActionFullVMCacheKey:t=>`${globalThis.vitraux.getFullVMKey(t)}-actions`,executeActionRegistrationsCode(t){new Function(t)()},createActionRegistrationsFunction(t,e){this.vmActions[t]=new Function(e)},executeActionRegistrationsFunction(t){(0,this.vmActions[t])()},registerActionSync(t,n,s,a){this.addActionListenerToElements(t,n,new o(new i(s,a,new e)))},registerActionAsync(t,n,o,a){this.addActionListenerToElements(t,n,new s(new i(o,a,new e)))},registerParametrizableActionSync(t,i,o,s,c){this.addActionListenerToElements(t,i,new a(new n(o,s,c,new e)))},registerParametrizableActionAsync(t,i,o,s,a){this.addActionListenerToElements(t,i,new c(new n(o,s,a,new e)))},addActionListenerToElements(t,e,i){for(const n of t)for(const t of e)n.addEventListener(t,i)},getActionFunctionCodeFromVersion(e,i){if(!e||!i)throw new t("vmKey and version must be set in getActionFunctionCodeFromVersion!");const n=localStorage.getItem(e);if(!n)return!1;const o=JSON.parse(n);return o.version===i&&o},storeActionsFunction(t,e,i,n){const o={actionsCode:i,actionRegistrationStrategy:n,version:e};localStorage.setItem(t,JSON.stringify(o))},tryInitializeActionsFunctionFromCacheByVersion(e,i){if(!e||!i)throw new t("Version must be set in tryInitializeActionsFunctionFromCacheByVersion!");const n=this.getActionFullVMCacheKey(e),o=this.getActionFunctionCodeFromVersion(n,i);return!!o&&(this.initializeActionRegistrationsByActionRegistrationStrategy(e,o.actionsCode,o.actionRegistrationStrategy),!0)},initializeNonCachedActionsFunction(t,e,i){this.initializeActionRegistrationsByActionRegistrationStrategy(t,e,i)},initializeNewActionsFunctionToCacheByVersion(e,i,n,o){if(!e||!i)throw new t("Version must be set in initializeNewActionsFunctionToCacheByVersion!");this.initializeActionRegistrationsByActionRegistrationStrategy(e,n,o);const s=this.getActionFullVMCacheKey(e);this.storeActionsFunction(s,i,n,o)},initializeActionRegistrationsByActionRegistrationStrategy(t,e,i){i===this.actionRegistrationStrategy.OnlyOnceAtStart?this.executeActionRegistrationsCode(e):this.createActionRegistrationsFunction(t,e)}}}};